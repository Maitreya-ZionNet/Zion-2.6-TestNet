# Project Audit — 2025-09-23

Scope: Docker/Compose topology, adapters, scripts, security/ops, CI, docs.

## Architecture Snapshot
- Core: `ziond` seeds (seed1/seed2) with healthchecks; `zion-rpc-shim` (Node) in front of `ziond` RPCs.
- Pool: `uzi-pool` (node-cryptonote-pool lineage), Redis backend, walletd + wallet-adapter.
- Exposure: Stratum on 3333; SSH patch exposes 443/80 to 3333 for restrictive networks.
- Monitoring: Optional Prometheus/Grafana compose present.

## Strengths
- Health-based startup and selective restarts (`--no-deps`), good lifecycle control.
- Remote patching via SSH scripts avoids heavy image uploads.
- Wallet backup scripts: encrypted variants (GPG / AES-256 PBKDF2).
- CI workflows present; Dockerfiles with explicit healthchecks.

## Gaps / Risks
- Core “Core is busy” affects pool: miners get EOF on 443; pool closes sockets without job — UX impact.
- Port 443 via `socat` not integrated in compose overrides by default (doc + sample missing until now).
- Mixed line endings and style across scripts; risk of shell portability issues (`set -o pipefail` on /bin/sh).
- Secrets management not centralized (UFW ok, but envs in compose may leak if not handled).
- README lacks quick-starts for Windows miners and SSH patch.

## Recommendations (Prioritized)
1) Pool UX with busy core
   - Keep TCP open and send temporary error instead of closing (configure pool or wrap stratum accept loop).
   - Increase shim backoff and cache last valid template (if protocol allows) to reduce hammering.
2) Compose overrides
   - Provide `docker/compose.override-ports.yml.sample` (443/80 → 3333), document usage.
3) Script hygiene
   - Add `.editorconfig` + `.gitattributes` for consistent EOL/indentation; enforce LF for sh/yml/Dockerfiles.
   - Validate shells: use `/bin/sh` compatible syntax in remote scripts.
4) Observability
   - Enable `compose.prometheus.yml` path documented; add alerts for `rpc-shim` health flapping, pool job starvation.
5) Security
   - Centralize secrets/env (wallet passphrases) via `.env` with `env_file` and exclude from repo; confirm UFW rules audit trail.
6) Docs
   - Expand scripts README (done) with Windows launcher and SSH patch; add quick miner start guide.

## Done in this audit
- Added Windows launcher `scripts/Start-Mining.ps1` with wallet/XMRig autodetect + 443→80→3333 failover.
- Updated `scripts/README.md` with launcher and SSH patch usage.
- Captured runtime log for Windows miner connecting via 443 and EOF due to busy core.
- Drafted this audit report with prioritized improvements.

## Next Steps
- Implement pool-side graceful handling during core busy; provide sample compose override for ports; add editor/attr configs.
